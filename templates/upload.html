<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>翻译工具 - Translation Utility</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/upload.css') }}" />
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1><i class="fas fa-language"></i> 翻译工具</h1>
        <p>支持 JavaScript 和 JSON 文件的多语言翻译</p>
      </div>

      <div class="content">
        <form
          id="translateForm"
          action="/translate"
          method="post"
          enctype="multipart/form-data"
        >
          <!-- 文件上传区域 -->
          <div class="upload-section">
            <h3><i class="fas fa-upload"></i> 上传文件</h3>
            <div
              class="file-upload"
              onclick="document.getElementById('fileInput').click()"
            >
              <i class="fas fa-cloud-upload-alt"></i>
              <h4>点击选择文件（可多选）或拖拽到此处</h4>
              <p>支持 .js、.json 和 .zip 压缩包，可拖拽文件夹</p>
              <input
                type="file"
                id="fileInput"
                name="file"
                accept=".js,.json,.zip"
                multiple
              />
              <!-- 隐藏的文件夹选择 input -->
              <input
                type="file"
                id="folderInput"
                webkitdirectory
                directory
                multiple
                style="display: none"
              />
              <div class="file-info" id="fileInfo"></div>
            </div>
            <!-- 文件夹选择按钮 -->
            <div style="margin-top: 10px; text-align: center;">
              <button type="button" class="folder-select-btn" onclick="handleFolderSelection(); event.stopPropagation();" style="
                background: linear-gradient(135deg, #a29bfe, #6c5ce7);
                color: white;
                border: none;
                padding: 8px 16px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 0.9em;
                transition: all 0.3s ease;
              ">
                <i class="fas fa-folder-open"></i> 选择文件夹
              </button>
              <span style="color: #666; font-size: 0.85em; margin-left: 10px;">
                递归导入文件夹内所有 .js/.json 文件
              </span>
            </div>

            <!-- 文件队列展示 -->
            <div class="file-queue-section" id="fileQueueSection" style="display: none;">
              <div class="queue-header">
                <h4><i class="fas fa-tasks"></i> 文件队列 <span id="queueCount">(0)</span></h4>
                <div class="queue-controls">
                  <button type="button" class="queue-control-btn download-all" id="downloadAllBtn" title="下载所有已完成的文件" disabled>
                    <i class="fas fa-download"></i> 下载全部
                  </button>
                  <button type="button" class="queue-control-btn" id="clearQueueBtn" title="清空队列">
                    <i class="fas fa-trash"></i> 清空
                  </button>
                </div>
              </div>
              <div class="file-queue-list" id="fileQueueList"></div>
              <div class="queue-summary">
                <div class="queue-stats">
                  <span class="stat-item"><i class="fas fa-clock"></i> 等待: <span id="waitingCount">0</span></span>
                  <span class="stat-item"><i class="fas fa-spinner"></i> 处理中: <span id="processingCount">0</span></span>
                  <span class="stat-item"><i class="fas fa-check-circle"></i> 完成: <span id="completedCount">0</span></span>
                  <span class="stat-item"><i class="fas fa-exclamation-circle"></i> 失败: <span id="failedCount">0</span></span>
                </div>
                <div class="queue-progress">
                  <div class="progress-bar-container">
                    <div class="progress-bar" id="queueProgressBar"></div>
                  </div>
                  <span class="progress-text" id="queueProgressText">0%</span>
                </div>
              </div>
            </div>
          </div>

          <!-- 语言选择区域 -->
          <div class="language-section">
            <h3><i class="fas fa-globe"></i> 选择目标语言</h3>

            <!-- 常用语言快选 -->
            <div class="popular-languages">
              <h4>常用语言</h4>
              <div class="language-tags" id="popularLanguages">
                <div
                  class="language-tag"
                  data-code="zh"
                  data-name="Chinese (Simplified)"
                >
                  中文 (简体)
                </div>
                <div
                  class="language-tag"
                  data-code="zh-TW"
                  data-name="Chinese (Traditional)"
                >
                  中文 (繁体)
                </div>
                <div class="language-tag" data-code="en" data-name="English">
                  English
                </div>
                <div class="language-tag" data-code="ja" data-name="Japanese">
                  日本語
                </div>
                <div class="language-tag" data-code="ko" data-name="Korean">
                  한국어
                </div>
                <div class="language-tag" data-code="fr" data-name="French">
                  Français
                </div>
                <div class="language-tag" data-code="de" data-name="German">
                  Deutsch
                </div>
                <div class="language-tag" data-code="es" data-name="Spanish">
                  Español
                </div>
                <div class="language-tag" data-code="ru" data-name="Russian">
                  Русский
                </div>
                <div class="language-tag" data-code="ar" data-name="Arabic">
                  العربية
                </div>
              </div>
            </div>

            <!-- 搜索框 -->
            <div class="search-container">
              <input
                type="text"
                class="search-input"
                id="languageSearch"
                placeholder="搜索语言... (例如: 法语, French, fr)"
              />
              <i class="fas fa-search search-icon"></i>
            </div>

            <!-- 搜索结果下拉框 -->
            <div class="language-dropdown" id="languageDropdown"></div>

            <!-- 已选择的语言 -->
            <div class="selected-languages">
              <h4>已选择的语言 (<span id="selectedCount">0</span>)</h4>
              <div class="selected-list" id="selectedList">
                <div class="empty-state">请选择要翻译的目标语言</div>
              </div>
            </div>
          </div>

          <!-- 翻译引擎选择 -->
          <div class="engine-section">
            <h3><i class="fas fa-cog"></i> 选择翻译引擎</h3>
            <div class="engine-options">
              <div class="engine-option selected" onclick="selectEngine(this, 'google')">
                <input type="radio" id="engine_google" name="translation_engine" value="google" checked>
                <label for="engine_google">
                  <i class="fab fa-google"></i> Google Translate
                </label>
              </div>
              <div class="engine-option" onclick="selectEngine(this, 'claude')">
                <input type="radio" id="engine_claude" name="translation_engine" value="claude">
                <label for="engine_claude">
                  <i class="fas fa-robot"></i> Claude API
                </label>
              </div>
            </div>

            <!-- Claude 模型选择器 -->
            <div class="model-selector" id="modelSelector">
              <label for="claudeModel"><i class="fas fa-microchip"></i> 选择 Claude 模型：</label>
              <select class="model-select" id="claudeModel" name="claude_model" onchange="updateModelDescription()">
                <option value="">加载中...</option>
              </select>
              <div class="model-description" id="modelDescription">正在获取可用模型列表...</div>
            </div>
          </div>

          <!-- 费用预估 -->
          <div class="cost-estimation" id="costEstimation" style="display: none;">
            <h3><i class="fas fa-calculator"></i> 费用预估</h3>
            <div style="margin-bottom: 10px;">
              <label style="font-size: 0.9em; color: #666;">
                <input type="checkbox" id="useApiCount" style="margin-right: 5px;">
                使用 API 精确计算（会消耗少量 API 调用）
              </label>
            </div>
            <div class="estimation-content" id="estimationContent">
              <div class="loading-spinner">
                <i class="fas fa-spinner fa-spin"></i> 计算中...
              </div>
            </div>
            <div class="estimation-warning">
              <i class="fas fa-exclamation-triangle"></i>
              <span>注意：此预估基于平均值计算，实际费用可能有 20-30% 的浮动，取决于内容复杂度和翻译质量。</span>
            </div>
          </div>

          <!-- 提交按钮 -->
          <div class="submit-section">
            <button type="button" class="estimate-btn" id="estimateBtn" onclick="estimateCost()" style="display: none;">
              <i class="fas fa-calculator"></i> 预估费用
            </button>
            <button type="submit" class="submit-btn" id="submitBtn" disabled>
              <i class="fas fa-magic"></i> 开始翻译
            </button>
          </div>

          <!-- 进度条 -->
          <div class="progress-section" id="progressSection">
            <h4>翻译进度</h4>
            <div class="progress-bar">
              <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">0%</div>
          </div>
        </form>
      </div>
    </div>

    <!-- Socket.IO -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>

    <!-- 服务器端渲染的数据（Jinja模板） -->
    <script>
      const languages = {{ languages | tojson }};
    </script>

    <!-- 应用逻辑 -->
    <script src="{{ url_for('static', filename='js/upload.js') }}"></script>
  </body>
</html>
